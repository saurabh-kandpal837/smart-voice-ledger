<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Voice Ledger - Kirana Shop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .voice-section, .ledger-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .microphone {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .microphone:hover {
            transform: scale(1.05);
        }

        .microphone.listening {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }

        .mic-icon {
            font-size: 2.5em;
            color: white;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .start-btn { background: #4CAF50; color: white; }
        .stop-btn { background: #f44336; color: white; }
        .clear-btn { background: #FF9800; color: white; }
        .export-btn { background: #2196F3; color: white; }

        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }

        #status {
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            margin: 15px 0;
            text-align: center;
            word-wrap: break-word;
        }

        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-info { background: #cce7ff; color: #004085; }
        .status-listening { background: #fff3cd; color: #856404; }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .summary-card h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .summary-amount {
            font-size: 1.5em;
            font-weight: bold;
        }

        .balance-positive { color: #4CAF50; }
        .balance-negative { color: #f44336; }
        .amount-positive { color: #4CAF50; font-weight: bold; }
        .amount-negative { color: #f44336; font-weight: bold; }

        .ledger-table {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 0.9em;
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }

        .entry-income { background: #e8f5e8; }
        .entry-expense { background: #ffeaea; }
        .entry-credit { background: #fff3e0; }

        .manual-entry {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .manual-entry input, .manual-entry select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .manual-entry button {
            width: 100%;
            margin-top: 10px;
        }

        .voice-commands {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .voice-commands h3 {
            color: #1565c0;
            margin-bottom: 15px;
        }

        .voice-commands ul {
            list-style: none;
            padding: 0;
        }

        .voice-commands li {
            margin: 5px 0;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
            font-size: 0.85em;
        }

        .customers-section {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .customers-section h3 {
            color: #0056b3;
            margin-bottom: 15px;
        }

        .customer-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 4px solid #0056b3;
            font-size: 0.9em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 200px;
            }

            th, td {
                font-size: 0.8em;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ Smart Voice Ledger</h1>
            <p class="subtitle">‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡•á ‡§π‡§ø‡§∏‡§æ‡§¨-‡§ï‡§ø‡§§‡§æ‡§¨</p>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <h3>üí∞ ‡§ï‡•Å‡§≤ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏</h3>
                <div class="summary-amount" id="totalBalance">‚Çπ0</div>
            </div>
            <div class="summary-card">
                <h3>üìà ‡§ï‡•Å‡§≤ ‡§Ü‡§Ø</h3>
                <div class="summary-amount amount-positive" id="totalIncome">‚Çπ0</div>
            </div>
            <div class="summary-card">
                <h3>üìâ ‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö</h3>
                <div class="summary-amount amount-negative" id="totalExpense">‚Çπ0</div>
            </div>
            <div class="summary-card">
                <h3>üîÑ ‡§â‡§ß‡§æ‡§∞‡•Ä</h3>
                <div class="summary-amount" id="totalCredit">‚Çπ0</div>
            </div>
        </div>

        <div class="main-content">
            <div class="voice-section">
                <h2 style="text-align: center; margin-bottom: 20px;">üé§ Voice Commands</h2>
                
                <div class="microphone" id="micButton" onclick="toggleListening()">
                    <div class="mic-icon">üé§</div>
                </div>
                
                <div class="controls">
                    <button class="start-btn" id="startBtn" onclick="startListening()">
                        üéôÔ∏è ‡§∏‡•Å‡§®‡•á‡§Ç
                    </button>
                    <button class="stop-btn" id="stopBtn" onclick="stopListening()" disabled>
                        ‚èπÔ∏è ‡§∞‡•ã‡§ï‡•á‡§Ç
                    </button>
                </div>
                
                <div id="status" class="status-info">
                    Voice ledger ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à! ‡§¨‡•ã‡§≤‡§ï‡§∞ entries add ‡§ï‡§∞‡•á‡§Ç‡•§
                </div>
                
                <div class="voice-commands">
                    <h3>üó£Ô∏è Voice Commands:</h3>
                    <ul>
                        <li><strong>üí∞ ‡§™‡•à‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á:</strong> "‡§∞‡§æ‡§Æ ‡§®‡•á 500 ‡§¶‡§ø‡§Ø‡•á" / "500 ‡§ú‡§Æ‡§æ ‡§∞‡§æ‡§Æ ‡§ï‡•á"</li>
                        <li><strong>üõí ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§¨‡•á‡§ö‡§æ:</strong> "‡§§‡•á‡§≤ 200 ‡§ï‡§æ ‡§¶‡§ø‡§Ø‡§æ" / "‡§¶‡•Ç‡§ß 50 ‡§¨‡•á‡§ö‡§æ"</li>
                        <li><strong>üîÑ ‡§â‡§ß‡§æ‡§∞‡•Ä:</strong> "‡§∞‡§æ‡§Æ ‡§ï‡•á 300 ‡§¨‡§æ‡§ï‡•Ä" / "‡§∂‡•ç‡§Ø‡§æ‡§Æ ‡§ï‡•ã 200 ‡§â‡§ß‡§æ‡§∞"</li>
                        <li><strong>üìä ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏:</strong> "balance ‡§¨‡§§‡§æ‡§ì" / "‡§π‡§ø‡§∏‡§æ‡§¨ ‡§¨‡§§‡§æ‡§ì"</li>
                        <li><strong>üìã Entries:</strong> "‡§Ü‡§ú ‡§ï‡•Ä entries ‡§¶‡§ø‡§ñ‡§æ‡§ì"</li>
                        <li><strong>üóëÔ∏è Clear:</strong> "‡§∏‡§¨ clear ‡§ï‡§∞‡•ã"</li>
                        <li><strong>üë§ Customer:</strong> "‡§∞‡§æ‡§Æ ‡§ï‡§æ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§¨‡§§‡§æ‡§ì"</li>
                    </ul>
                </div>

                <div class="customers-section">
                    <h3>üë• Customer Balance:</h3>
                    <div id="customersList">
                        <div style="text-align: center; color: #666; padding: 20px;">
                            ‡§ï‡•ã‡§à customer balance ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à
                        </div>
                    </div>
                </div>
                
                <div class="manual-entry">
                    <h3>‚úèÔ∏è Manual Entry:</h3>
                    <select id="entryType">
                        <option value="income">Income (‡§Ü‡§Ø)</option>
                        <option value="expense">Expense (‡§ñ‡§∞‡•ç‡§ö)</option>
                        <option value="credit">Credit/‡§â‡§ß‡§æ‡§∞‡•Ä</option>
                    </select>
                    <input type="text" id="customerName" placeholder="Customer Name (‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ)">
                    <input type="number" id="amount" placeholder="Amount (‡§∞‡§ï‡§Æ)" step="0.01">
                    <input type="text" id="description" placeholder="Description (‡§µ‡§ø‡§µ‡§∞‡§£)">
                    <button class="start-btn" onclick="addManualEntry()">üìù Add Entry</button>
                </div>
            </div>

            <div class="ledger-section">
                <h2 style="margin-bottom: 20px;">üìã Ledger Entries</h2>
                
                <div class="controls">
                    <button class="export-btn" onclick="exportData()">üíæ Export</button>
                    <button class="clear-btn" onclick="clearAllData()">üóëÔ∏è Clear All</button>
                </div>
                
                <div class="ledger-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Type</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="ledgerBody">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #666;">
                                    ‡§ï‡•ã‡§à entries ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§ Voice command ‡§Ø‡§æ manual entry ‡§∏‡•á add ‡§ï‡§∞‡•á‡§Ç‡•§
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let recognition = null;
        let isListening = false;
        let ledgerData = JSON.parse(localStorage.getItem('voiceLedgerData') || '[]');
        let customers = JSON.parse(localStorage.getItem('customerData') || '{}');

        // Common Indian names for recognition
        const commonNames = [
            '‡§∞‡§æ‡§Æ', '‡§∂‡•ç‡§Ø‡§æ‡§Æ', '‡§ó‡•Ä‡§§‡§æ', '‡§∏‡•Ä‡§§‡§æ', '‡§Æ‡•ã‡§π‡§®', '‡§∞‡•ã‡§π‡§®', '‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ', '‡§Ö‡§®‡§ø‡§≤', '‡§∏‡•Å‡§®‡•Ä‡§≤', '‡§µ‡§ø‡§ï‡§æ‡§∏', 
            '‡§∞‡§æ‡§π‡•Å‡§≤', '‡§™‡•ç‡§∞‡•Ä‡§§‡§ø', '‡§∏‡•Å‡§Æ‡§ø‡§§‡•ç‡§∞‡§æ', '‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä', '‡§Ö‡§Æ‡§ø‡§§', '‡§∏‡•Å‡§Æ‡§®', '‡§∞‡•Ä‡§§‡§æ', '‡§™‡•Ç‡§ú‡§æ', '‡§Ö‡§ú‡§Ø', '‡§∏‡§Ç‡§ú‡§Ø', 
            '‡§¶‡•Ä‡§™‡§ï', '‡§Æ‡•Ä‡§∞‡§æ', '‡§∞‡§Æ‡•á‡§∂', '‡§∏‡•Å‡§∞‡•á‡§∂', '‡§ï‡§Æ‡§≤', '‡§®‡•Ä‡§§‡§æ', '‡§ó‡•Ä‡§§‡§æ', '‡§∏‡•Å‡§®‡•Ä‡§§‡§æ', '‡§Æ‡§®‡•Ä‡§∑', '‡§∞‡§æ‡§ú'
        ];

        // Kirana/Grocery items comprehensive list
        const kiranaItems = [
            // Oil & Cooking
            '‡§§‡•á‡§≤', 'oil', '‡§∏‡§∞‡§∏‡•ã‡§Ç', 'mustard', '‡§∏‡•Ç‡§∞‡§ú‡§Æ‡•Å‡§ñ‡•Ä', 'sunflower', '‡§∞‡§ø‡§´‡§æ‡§á‡§Ç‡§°', '‡§ò‡•Ä', 'ghee',
            
            // Dairy
            '‡§¶‡•Ç‡§ß', 'milk', '‡§¶‡§π‡•Ä', 'curd', '‡§Ø‡•ã‡§ó‡§∞‡•ç‡§ü', 'yogurt', '‡§™‡§®‡•Ä‡§∞', 'paneer', '‡§Æ‡§ï‡•ç‡§ñ‡§®', 'butter', 'cream', '‡§ï‡•ç‡§∞‡•Ä‡§Æ',
            
            // Personal Care & Cleaning
            '‡§∏‡§æ‡§¨‡•Å‡§®', 'soap', '‡§∏‡§∞‡•ç‡§´', 'surf', '‡§∂‡•à‡§Æ‡•ç‡§™‡•Ç', 'shampoo', '‡§ü‡•Ç‡§•‡§™‡•á‡§∏‡•ç‡§ü', 'toothpaste',
            '‡§´‡•á‡§∏‡§µ‡§æ‡§∂', 'facewash', '‡§≤‡•ã‡§∂‡§®', 'lotion', '‡§°‡§ø‡§ü‡§∞‡•ç‡§ú‡•á‡§Ç‡§ü', 'detergent', '‡§ù‡§æ‡§°‡§º‡•Ç', 'broom',
            '‡§™‡•ã‡§õ‡§æ', 'mop', '‡§´‡§ø‡§®‡§æ‡§á‡§≤', 'phenyl', '‡§π‡•à‡§Ç‡§°‡§µ‡§æ‡§∂', 'handwash', 'tissue', '‡§ü‡§ø‡§∂‡•ç‡§Ø‡•Ç',
            
            // Grains & Pulses  
            '‡§ö‡§æ‡§µ‡§≤', 'rice', '‡§ó‡•á‡§π‡•Ç‡§Ç', 'wheat', '‡§Ü‡§ü‡§æ', 'flour', '‡§¶‡§æ‡§≤', 'dal', '‡§ö‡§®‡§æ', 'chana',
            '‡§Æ‡•Ç‡§Ç‡§ó', 'moong', '‡§Æ‡§∏‡•Ç‡§∞', 'masur', '‡§§‡•Å‡§Ö‡§∞', 'tuar', '‡§Ö‡§∞‡§π‡§∞', 'arhar', '‡§∞‡§æ‡§ú‡§Æ‡§æ', 'rajma',
            '‡§õ‡•ã‡§≤‡•á', 'chole', '‡§ï‡§¨‡•Å‡§≤‡•Ä ‡§ö‡§®‡§æ', 'kabuli chana', '‡§¨‡•á‡§∏‡§®', 'besan',
            
            // Spices & Condiments
            '‡§®‡§Æ‡§ï', 'salt', '‡§ö‡•Ä‡§®‡•Ä', 'sugar', '‡§π‡§≤‡•ç‡§¶‡•Ä', 'turmeric', '‡§ß‡§®‡§ø‡§Ø‡§æ', 'coriander', '‡§ú‡•Ä‡§∞‡§æ', 'cumin',
            '‡§≤‡§æ‡§≤ ‡§Æ‡§ø‡§∞‡•ç‡§ö', 'red chilli', '‡§π‡§∞‡•Ä ‡§Æ‡§ø‡§∞‡•ç‡§ö', 'green chilli', '‡§ó‡§∞‡§Æ ‡§Æ‡§∏‡§æ‡§≤‡§æ', 'garam masala',
            '‡§Ö‡§ú‡§µ‡§æ‡§á‡§®', 'ajwain', '‡§π‡•Ä‡§Ç‡§ó', 'hing', '‡§Æ‡•á‡§•‡•Ä', 'methi', '‡§ï‡§æ‡§≤‡•Ä ‡§Æ‡§ø‡§∞‡•ç‡§ö', 'black pepper',
            
            // Vegetables (common)
            '‡§™‡•ç‡§Ø‡§æ‡§ú', 'onion', '‡§Ü‡§≤‡•Ç', 'potato', '‡§ü‡§Æ‡§æ‡§ü‡§∞', 'tomato', '‡§Ö‡§¶‡§∞‡§ï', 'ginger', '‡§≤‡§π‡§∏‡•Å‡§®', 'garlic',
            '‡§≠‡§ø‡§Ç‡§°‡•Ä', 'okra', '‡§¨‡•à‡§Ç‡§ó‡§®', 'brinjal', '‡§ó‡•ã‡§≠‡•Ä', 'cauliflower', '‡§™‡§§‡•ç‡§§‡§æ‡§ó‡•ã‡§≠‡•Ä', 'cabbage',
            
            // Packaged Items
            '‡§¨‡§ø‡§∏‡•ç‡§ï‡•Å‡§ü', 'biscuit', '‡§ö‡§æ‡§Ø', 'tea', '‡§ï‡•â‡§´‡•Ä', 'coffee', '‡§ö‡•â‡§ï‡§≤‡•á‡§ü', 'chocolate', '‡§®‡§Æ‡§ï‡•Ä‡§®', 'namkeen',
            '‡§Æ‡•à‡§ó‡•Ä', 'maggi', '‡§®‡•Ç‡§°‡§≤‡•ç‡§∏', 'noodles', '‡§¨‡•ç‡§∞‡•á‡§°', 'bread', '‡§ú‡•à‡§Æ', 'jam', '‡§Ö‡§ö‡§æ‡§∞', 'pickle',
            '‡§ï‡•á‡§ö‡§™', 'ketchup', '‡§∏‡•â‡§∏', 'sauce', '‡§Æ‡§∏‡§æ‡§≤‡§æ', 'masala',
            
            // Beverages
            '‡§™‡§æ‡§®‡•Ä', 'water', '‡§∏‡•â‡§´‡•ç‡§ü ‡§°‡•ç‡§∞‡§ø‡§Ç‡§ï', 'soft drink', '‡§ú‡•Ç‡§∏', 'juice', '‡§≤‡§∏‡•ç‡§∏‡•Ä', 'lassi', '‡§´‡•ç‡§∞‡•Ç‡§ü‡•Ä', 'frooti',
            
            // Stationery (for journal/variety store)
            '‡§™‡•á‡§®', 'pen', '‡§™‡•á‡§Ç‡§∏‡§ø‡§≤', 'pencil', '‡§∞‡§¨‡§∞', 'rubber', 'eraser', '‡§®‡•ã‡§ü‡§¨‡•Å‡§ï', 'notebook', '‡§ï‡•â‡§™‡•Ä', 'copy',
            '‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞', 'register', '‡§ï‡§æ‡§ó‡§ú', 'paper', '‡§∏‡•ç‡§ï‡•á‡§≤', 'scale', 'ruler', '‡§ï‡•à‡§Ç‡§ö‡•Ä', 'scissors',
            
            // General terms
            '‡§∏‡§æ‡§Æ‡§æ‡§®', 'saman', 'item', '‡§ö‡•Ä‡§ú', 'cheez', '‡§∞‡§æ‡§∂‡§®', 'ration', 'grocery', '‡§ï‡§ø‡§∞‡§æ‡§®‡§æ', '‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä'
        ];

        // Initialize app
        window.addEventListener('load', () => {
            checkBrowserSupport();
            loadLedgerData();
            updateSummary();
            updateCustomersList();
        });

        // Check browser support with detailed debugging
        function checkBrowserSupport() {
            console.log('Checking browser support...');
            console.log('User Agent:', navigator.userAgent);
            console.log('webkitSpeechRecognition:', 'webkitSpeechRecognition' in window);
            console.log('SpeechRecognition:', 'SpeechRecognition' in window);
            console.log('Location:', window.location.protocol, window.location.hostname);
            
            // Check for Web Speech API (NOT getUserMedia)
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                updateStatus('‚ùå Voice recognition support ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ Chrome browser use ‡§ï‡§∞‡•á‡§Ç‡•§', 'error');
                document.getElementById('startBtn').disabled = true;
                document.getElementById('micButton').style.opacity = '0.5';
                document.getElementById('micButton').style.cursor = 'not-allowed';
                
                // Show detailed error info
                showDetailedError();
                return false;
            }
            
            // Check if HTTPS (required for speech recognition in production)
            if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                updateStatus('‚ö†Ô∏è HTTPS connection required for voice recognition in production.', 'error');
                return false;
            }
            
            updateStatus('‚úÖ Voice recognition ready! ‡§Æ‡§æ‡§á‡§ï ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§ï‡§∞ ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§', 'success');
            return true;
        }
        
        // Show detailed error information
        function showDetailedError() {
            const errorInfo = document.createElement('div');
            errorInfo.style.cssText = `
                background: #fff3cd; 
                border: 1px solid #ffeaa7; 
                padding: 15px; 
                margin: 15px 0; 
                border-radius: 10px;
                font-size: 0.9em;
            `;
            errorInfo.innerHTML = `
                <h3 style="color: #856404; margin-bottom: 10px;">üîß Debugging Information:</h3>
                <p><strong>Browser:</strong> ${navigator.userAgent}</p>
                <p><strong>Protocol:</strong> ${window.location.protocol}</p>
                <p><strong>Host:</strong> ${window.location.hostname}</p>
                <p><strong>webkitSpeechRecognition:</strong> ${'webkitSpeechRecognition' in window ? '‚úÖ Available' : '‚ùå Not Available'}</p>
                <p><strong>SpeechRecognition:</strong> ${'SpeechRecognition' in window ? '‚úÖ Available' : '‚ùå Not Available'}</p>
                <br>
                <p><strong>Solutions:</strong></p>
                <ul>
                    <li>Chrome browser use ‡§ï‡§∞‡•á‡§Ç (recommended)</li>
                    <li>HTTPS connection use ‡§ï‡§∞‡•á‡§Ç (localhost OK ‡§π‡•à)</li>
                    <li>Microphone permissions check ‡§ï‡§∞‡•á‡§Ç</li>
                    <li>Browser ‡§ï‡•ã update ‡§ï‡§∞‡•á‡§Ç</li>
                </ul>
            `;
            
            document.querySelector('.voice-section').appendChild(errorInfo);
        }

        // Initialize speech recognition (Web Speech API - NO getUserMedia needed!)
        function initializeSpeechRecognition() {
            try {
                // Use Web Speech API (NOT media devices)
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    throw new Error('Speech Recognition not supported');
                }
                
                recognition = new SpeechRecognition();
                
                // Configure speech recognition
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'hi-IN';
                recognition.maxAlternatives = 1;

                recognition.onstart = function() {
                    isListening = true;
                    updateMicrophoneState(true);
                    updateStatus('üéôÔ∏è ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å... ‡§¨‡•ã‡§≤‡§ø‡§è!', 'listening');
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                };

                recognition.onresult = function(event) {
                    if (event.results && event.results.length > 0) {
                        const command = event.results[0][0].transcript;
                        updateStatus(`‡§Ü‡§™‡§®‡•á ‡§ï‡§π‡§æ: "${command}"`, 'info');
                        processVoiceCommand(command);
                    }
                };

                recognition.onerror = function(event) {
                    console.log('Speech recognition error:', event.error);
                    let errorMessage = '';
                    switch(event.error) {
                        case 'not-allowed':
                            errorMessage = '‚ùå Microphone permission denied. Browser settings ‡§Æ‡•á‡§Ç allow ‡§ï‡§∞‡•á‡§Ç‡•§';
                            break;
                        case 'no-speech':
                            errorMessage = '‚ö†Ô∏è ‡§ï‡•ã‡§à ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§®‡§π‡•Ä‡§Ç ‡§∏‡•Å‡§®‡§æ‡§à ‡§¶‡•Ä‡•§ ‡§´‡§ø‡§∞ try ‡§ï‡§∞‡•á‡§Ç‡•§';
                            break;
                        case 'network':
                            errorMessage = '‚ùå Network error. Internet connection check ‡§ï‡§∞‡•á‡§Ç‡•§';
                            break;
                        case 'audio-capture':
                            errorMessage = '‚ùå Audio capture failed. Microphone check ‡§ï‡§∞‡•á‡§Ç‡•§';
                            break;
                        default:
                            errorMessage = `‚ö†Ô∏è Voice error: ${event.error}. ‡§´‡§ø‡§∞ try ‡§ï‡§∞‡•á‡§Ç‡•§`;
                    }
                    updateStatus(errorMessage, 'error');
                    stopListening();
                };

                recognition.onend = function() {
                    stopListening();
                };
                
            } catch (error) {
                console.error('Speech recognition initialization failed:', error);
                updateStatus('‚ùå Voice recognition initialize ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§æ‡•§', 'error');
            }
        }

        // Enhanced voice command processing for Kirana shop
        function processVoiceCommand(command) {
            console.log('Processing voice command:', command);
            
            // Extract numbers/amounts
            const amountMatch = command.match(/(\d+(?:\.\d+)?)/);
            const amount = amountMatch ? parseFloat(amountMatch[1]) : 0;
            
            // Extract customer names
            const customerName = extractCustomerName(command);
            
            // Balance inquiry commands
            if (command.includes('balance') || command.includes('‡§¨‡•à‡§≤‡•á‡§Ç‡§∏') || command.includes('‡§π‡§ø‡§∏‡§æ‡§¨') || command.includes('‡§¨‡§§‡§æ‡§ì')) {
                if (customerName) {
                    speakCustomerBalance(customerName);
                } else {
                    speakTotalBalance();
                }
                return;
            }
            
            // Show entries commands
            if (command.includes('entries') || command.includes('‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú') || command.includes('‡§Ü‡§ú') || command.includes('‡§¶‡§ø‡§ñ‡§æ‡§ì')) {
                speakTodayEntries();
                return;
            }
            
            // Clear commands
            if ((command.includes('clear') || command.includes('‡§∏‡§æ‡§´') || command.includes('‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞')) && 
                (command.includes('‡§∏‡§¨') || command.includes('all'))) {
                clearAllData();
                speak('‡§∏‡§≠‡•Ä entries ‡§î‡§∞ customer data clear ‡§π‡•ã ‡§ó‡§Ø‡§æ');
                return;
            }

            // Process transaction commands
            if (amount > 0) {
                processTransactionCommand(command, amount, customerName);
            } else {
                updateStatus('‚ùå Amount ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ú‡•à‡§∏‡•á: "‡§∞‡§æ‡§Æ ‡§®‡•á 500 ‡§¶‡§ø‡§Ø‡•á" ‡§Ø‡§æ "‡§§‡•á‡§≤ 200 ‡§ï‡§æ ‡§¶‡§ø‡§Ø‡§æ"', 'error');
                speak('Amount ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à');
            }
        }

        // Extract customer name from command
        function extractCustomerName(command) {
            // Look for common patterns with names
            for (const name of commonNames) {
                if (command.includes(name.toLowerCase()) || command.includes(name)) {
                    return name;
                }
            }
            
            // Pattern matching for "X ‡§®‡•á", "X ‡§ï‡•ã", "X ‡§ï‡§æ", "X ‡§ï‡•á"
            const namePatterns = [
                /([a-zA-Z\u0900-\u097F]+)\s*(‡§®‡•á|‡§ï‡•ã|‡§ï‡§æ|‡§ï‡•á|‡§∏‡•á)\s/,
                /([a-zA-Z\u0900-\u097F]+)\s*(‡§¶‡§ø‡§Ø‡•á|‡§¶‡§ø‡§Ø‡§æ|‡§¨‡§æ‡§ï‡•Ä|‡§â‡§ß‡§æ‡§∞)/,
            ];
            
            for (const pattern of namePatterns) {
                const match = command.match(pattern);
                if (match && match[1] && match[1].length > 1) {
                    return match[1];
                }
            }
            
            return null;
        }

        // Process different types of transactions
        function processTransactionCommand(command, amount, customerName) {
            let type = '';
            let description = '';
            
            // Income patterns - money received
            if (command.includes('‡§¶‡§ø‡§Ø‡•á') || command.includes('‡§¶‡§ø‡§Ø‡§æ') || command.includes('‡§¶‡•Ä') ||
                command.includes('‡§Æ‡§ø‡§≤‡•á') || command.includes('‡§Æ‡§ø‡§≤‡•Ä') || command.includes('‡§ú‡§Æ‡§æ') ||
                command.includes('payment') || command.includes('‡§™‡•á‡§Æ‡•á‡§Ç‡§ü')) {
                
                type = 'income';
                description = customerName ? `${customerName} ‡§∏‡•á payment` : 'Payment ‡§Æ‡§ø‡§≤‡•Ä';
                
            }
            // Credit/Udhaar patterns - money owed
            else if (command.includes('‡§¨‡§æ‡§ï‡•Ä') || command.includes('‡§â‡§ß‡§æ‡§∞') || command.includes('credit') ||
                     command.includes('‡§¶‡•á‡§®‡§æ') || command.includes('‡§¨‡§ï‡§æ‡§Ø‡§æ')) {
                
                type = 'credit';
                description = customerName ? `${customerName} ‡§ï‡•ã ‡§â‡§ß‡§æ‡§∞` : '‡§â‡§ß‡§æ‡§∞‡•Ä';
                
            }
            // Sales/Income patterns - items sold
            else if (hasKiranaItem(command) || command.includes('‡§¨‡•á‡§ö‡§æ') || command.includes('‡§¶‡§ø‡§Ø‡§æ') ||
                     command.includes('‡§ï‡§æ') || command.includes('‡§ï‡•Ä')) {
                
                type = 'income';
                const item = extractKiranaItem(command);
                description = customerName ? 
                    `${customerName} ‡§ï‡•ã ${item || '‡§∏‡§æ‡§Æ‡§æ‡§®'} ‡§¨‡•á‡§ö‡§æ` : 
                    `${item || '‡§∏‡§æ‡§Æ‡§æ‡§®'} ‡§¨‡•á‡§ö‡§æ`;
                
            }
            // Default to expense if no clear pattern
            else {
                type = 'expense';
                description = customerName ? `${customerName} - ‡§ñ‡§∞‡•ç‡§ö` : '‡§ñ‡§∞‡•ç‡§ö';
            }
            
            // Add entry
            addLedgerEntry(type, amount, description, customerName);
            
            // Update customer balance
            if (customerName) {
                updateCustomerBalance(customerName, amount, type);
            }
            
            // Provide feedback
            const typeHindi = type === 'income' ? '‡§Ü‡§Ø' : (type === 'credit' ? '‡§â‡§ß‡§æ‡§∞‡•Ä' : '‡§ñ‡§∞‡•ç‡§ö');
            const message = `‚úÖ ${amount} ‡§∞‡•Å‡§™‡§è ${typeHindi} - ${description}`;
            updateStatus(message, 'success');
            speak(`${amount} ‡§∞‡•Å‡§™‡§è ${typeHindi} add ‡§π‡•ã ‡§ó‡§Ø‡§æ`);
        }

        // Check if command contains kirana items
        function hasKiranaItem(command) {
            return kiranaItems.some(item => command.includes(item.toLowerCase()));
        }

        // Extract kirana item from command
        function extractKiranaItem(command) {
            for (const item of kiranaItems) {
                if (command.includes(item.toLowerCase())) {
                    return item;
                }
            }
            return null;
        }

        // Add ledger entry
        function addLedgerEntry(type, amount, description, customerName = null) {
            const entry = {
                id: Date.now(),
                date: new Date().toLocaleDateString('hi-IN'),
                time: new Date().toLocaleTimeString('hi-IN'),
                type: type,
                amount: amount,
                description: description,
                customer: customerName
            };
            
            ledgerData.unshift(entry);
            saveLedgerData();
            loadLedgerData();
            updateSummary();
        }

        // Update customer balance
        function updateCustomerBalance(customerName, amount, type) {
            if (!customers[customerName]) {
                customers[customerName] = { balance: 0, lastTransaction: new Date().toISOString() };
            }
            
            if (type === 'income') {
                customers[customerName].balance -= amount; // Customer paid, their debt reduces
            } else if (type === 'credit') {
                customers[customerName].balance += amount; // Customer owes more
            } else {
                customers[customerName].balance += amount; // Customer bought items on credit
            }
            
            customers[customerName].lastTransaction = new Date().toISOString();
            saveCustomerData();
            updateCustomersList();
        }

        // Manual entry
        function addManualEntry() {
            const type = document.getElementById('entryType').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const description = document.getElementById('description').value.trim();
            const customerName = document.getElementById('customerName').value.trim();
            
            if (!amount || amount <= 0) {
                updateStatus('‚ùå Valid amount enter ‡§ï‡§∞‡•á‡§Ç‡•§', 'error');
                return;
            }
            
            addLedgerEntry(type, amount, description || 'Manual entry', customerName || null);
            
            if (customerName) {
                updateCustomerBalance(customerName, amount, type);
            }
            
            // Clear form
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
            document.getElementById('customerName').value = '';
            
            updateStatus('‚úÖ Manual entry add ‡§π‡•ã ‡§ó‡§à‡•§', 'success');
        }

        // Delete entry
        function deleteEntry(id) {
            const entry = ledgerData.find(e => e.id === id);
            if (entry && entry.customer) {
                // Reverse the customer balance change
                if (customers[entry.customer]) {
                    if (entry.type === 'income') {
                        customers[entry.customer].balance += entry.amount;
                    } else {
                        customers[entry.customer].balance -= entry.amount;
                    }
                    saveCustomerData();
                    updateCustomersList();
                }
            }
            
            ledgerData = ledgerData.filter(entry => entry.id !== id);
            saveLedgerData();
            loadLedgerData();
            updateSummary();
            updateStatus('‚úÖ Entry delete ‡§π‡•ã ‡§ó‡§à‡•§', 'success');
        }

        // Load ledger data into table
        function loadLedgerData() {
            const tbody = document.getElementById('ledgerBody');
            
            if (ledgerData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #666;">
                            ‡§ï‡•ã‡§à entries ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§ Voice command ‡§Ø‡§æ manual entry ‡§∏‡•á add ‡§ï‡§∞‡•á‡§Ç‡•§
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = ledgerData.map(entry => `
                <tr class="entry-${entry.type}">
                    <td>${entry.date}<br><small>${entry.time}</small></td>
                    <td>
                        <span style="padding: 5px 10px; border-radius: 15px; color: white; font-size: 0.8em; 
                               background: ${entry.type === 'income' ? '#4CAF50' : entry.type === 'credit' ? '#FF9800' : '#f44336'}">
                            ${entry.type === 'income' ? 'üìà ‡§Ü‡§Ø' : entry.type === 'credit' ? 'üîÑ ‡§â‡§ß‡§æ‡§∞‡•Ä' : 'üìâ ‡§ñ‡§∞‡•ç‡§ö'}
                        </span>
                    </td>
                    <td>${entry.customer || '-'}</td>
                    <td class="amount-${entry.type === 'income' ? 'positive' : 'negative'}">
                        ${entry.type === 'income' ? '+' : entry.type === 'credit' ? '‚óä' : '-'}‚Çπ${entry.amount.toFixed(2)}
                    </td>
                    <td>${entry.description}</td>
                    <td>
                        <button onclick="deleteEntry(${entry.id})" 
                                style="background: #f44336; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.8em;">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Update summary
        function updateSummary() {
            const totalIncome = ledgerData.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0);
            const totalExpense = ledgerData.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0);
            const totalCredit = ledgerData.filter(e => e.type === 'credit').reduce((sum, e) => sum + e.amount, 0);
            const totalBalance = totalIncome - totalExpense;
            
            document.getElementById('totalBalance').textContent = `‚Çπ${totalBalance.toFixed(2)}`;
            document.getElementById('totalIncome').textContent = `‚Çπ${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpense').textContent = `‚Çπ${totalExpense.toFixed(2)}`;
            document.getElementById('totalCredit').textContent = `‚Çπ${totalCredit.toFixed(2)}`;
            
            // Update balance color
            const balanceEl = document.getElementById('totalBalance');
            balanceEl.className = `summary-amount ${totalBalance >= 0 ? 'balance-positive' : 'balance-negative'}`;
        }

        // Update customers list
        function updateCustomersList() {
            const customersList = document.getElementById('customersList');
            
            if (Object.keys(customers).length === 0) {
                customersList.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        ‡§ï‡•ã‡§à customer balance ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à
                    </div>
                `;
                return;
            }
            
            const sortedCustomers = Object.entries(customers)
                .filter(([name, data]) => Math.abs(data.balance) > 0.01)
                .sort(([,a], [,b]) => b.balance - a.balance);
            
            if (sortedCustomers.length === 0) {
                customersList.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        ‡§∏‡§≠‡•Ä customers ‡§ï‡§æ balance clear ‡§π‡•à
                    </div>
                `;
                return;
            }
            
            customersList.innerHTML = sortedCustomers.map(([name, data]) => `
                <div class="customer-item">
                    <span><strong>${name}</strong></span>
                    <span class="${data.balance > 0 ? 'amount-negative' : 'amount-positive'}">
                        ${data.balance > 0 ? `‚Çπ${data.balance.toFixed(2)} ‡§¨‡§æ‡§ï‡•Ä` : `‚Çπ${Math.abs(data.balance).toFixed(2)} ‡§ú‡§Æ‡§æ`}
                    </span>
                </div>
            `).join('');
        }

        // Speech functions
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'hi-IN';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function speakTotalBalance() {
            const totalIncome = ledgerData.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0);
            const totalExpense = ledgerData.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0);
            const totalCredit = ledgerData.filter(e => e.type === 'credit').reduce((sum, e) => sum + e.amount, 0);
            const balance = totalIncome - totalExpense;
            
            speak(`‡§Ü‡§™‡§ï‡§æ ‡§ï‡•Å‡§≤ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§π‡•à ${balance} ‡§∞‡•Å‡§™‡§è‡•§ ‡§ï‡•Å‡§≤ ‡§Ü‡§Ø ${totalIncome} ‡§∞‡•Å‡§™‡§è, ‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö ${totalExpense} ‡§∞‡•Å‡§™‡§è, ‡§î‡§∞ ‡§ï‡•Å‡§≤ ‡§â‡§ß‡§æ‡§∞‡•Ä ${totalCredit} ‡§∞‡•Å‡§™‡§è‡•§`);
        }

        function speakCustomerBalance(customerName) {
            if (customers[customerName]) {
                const balance = customers[customerName].balance;
                if (balance > 0) {
                    speak(`${customerName} ‡§ï‡•á ${balance} ‡§∞‡•Å‡§™‡§è ‡§¨‡§æ‡§ï‡•Ä ‡§π‡•à‡§Ç‡•§`);
                } else if (balance < 0) {
                    speak(`${customerName} ‡§ï‡•á ${Math.abs(balance)} ‡§∞‡•Å‡§™‡§è ‡§ú‡§Æ‡§æ ‡§π‡•à‡§Ç‡•§`);
                } else {
                    speak(`${customerName} ‡§ï‡§æ balance clear ‡§π‡•à‡•§`);
                }
            } else {
                speak(`${customerName} ‡§ï‡§æ ‡§ï‡•ã‡§à record ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§`);
            }
        }

        function speakTodayEntries() {
            const today = new Date().toLocaleDateString('hi-IN');
            const todayEntries = ledgerData.filter(entry => entry.date === today);
            
            if (todayEntries.length === 0) {
                speak('‡§Ü‡§ú ‡§ï‡•Ä ‡§ï‡•ã‡§à entries ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§');
                return;
            }
            
            let text = `‡§Ü‡§ú ‡§ï‡•Ä ${todayEntries.length} entries ‡§π‡•à‡§Ç: `;
            todayEntries.slice(0, 5).forEach(entry => {
                const type = entry.type === 'income' ? '‡§Ü‡§Ø' : entry.type === 'credit' ? '‡§â‡§ß‡§æ‡§∞‡•Ä' : '‡§ñ‡§∞‡•ç‡§ö';
                text += `${entry.amount} ‡§∞‡•Å‡§™‡§è ${type}, ${entry.description}‡•§ `;
            });
            
            speak(text);
        }

        function stopListening() {
            if (recognition && isListening) {
                try {
                    recognition.stop();
                } catch (error) {
                    console.log('Error stopping recognition:', error);
                }
                
                isListening = false;
                updateMicrophoneState(false);
                updateStatus('‚èπÔ∏è Voice recognition ‡§∞‡•Å‡§ï ‡§ó‡§Ø‡§æ‡•§', 'info');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
            }
        }

        function updateMicrophoneState(listening) {
            const micButton = document.getElementById('micButton');
            if (listening) {
                micButton.classList.add('listening');
            } else {
                micButton.classList.remove('listening');
            }
        }

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status-${type}`;
        }

        // Data management
        function saveLedgerData() {
            localStorage.setItem('voiceLedgerData', JSON.stringify(ledgerData));
        }

        function saveCustomerData() {
            localStorage.setItem('customerData', JSON.stringify(customers));
        }

        function clearAllData() {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡§≠‡•Ä entries ‡§î‡§∞ customer data delete ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                ledgerData = [];
                customers = {};
                saveLedgerData();
                saveCustomerData();
                loadLedgerData();
                updateSummary();
                updateCustomersList();
                updateStatus('üóëÔ∏è ‡§∏‡§≠‡•Ä data clear ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§', 'info');
            }
        }

        function exportData() {
            const csvContent = [
                ['Date', 'Time', 'Type', 'Customer', 'Amount', 'Description'].join(','),
                ...ledgerData.map(entry => [
                    entry.date,
                    entry.time,
                    entry.type,
                    entry.customer || '',
                    entry.amount,
                    `"${entry.description}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `voice-ledger-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            updateStatus('üì• Data export ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space' && !event.target.matches('input, textarea, select')) {
                event.preventDefault();
                toggleListening();
            }
        });
    </script>
</body>
</html>)